<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel with Header</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            flex-direction: column;
            margin: 0;
        }
        .header {
            width: 100%;
            background-color: #007bff;
            color: white;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            position: fixed;
            top: 0;
            left: 0;
            z-index: 1000;
        }
        .header button {
            padding: 10px 15px;
            background-color: white;
            color: #007bff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .header button:hover {
            background-color: #f0f0f0;
        }
        .admin-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            width: 600px;
            margin-top: 80px; /* To make space for header */
            text-align: center;
        }
        #editor, #postTitle {
            display: none; /* Initially hidden */
            margin-bottom: 20px;
        }
        .ql-toolbar {
            display: none; /* Initially hide the toolbar */
        }
        button {
            padding: 10px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .posts {
            width: 90%;
            margin-top: 20px;
            text-align: left;
        }
        .post {
            width: 90%;
            padding: 10px;
            border-bottom: 1px solid #ddd;
        }
    </style>
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
</head>
<body>

    <div class="header">
        <button id="createPostButton">Create a New Post</button>
        <button id="logoutButton">Logout</button>
    </div>

    <div class="admin-container">
        <h2>Admin Panel</h2>
        
        <input type="text" id="postTitle" placeholder="Post Title" style="width: 100%; padding: 10px; border-radius: 4px; border: 1px solid #ddd;" />
        <div id="editor" style="height: 200px; background: #fff;"></div>
        <button id="submitPost" style="display: none;">Submit Post</button>
        <div id="posts" class="posts"></div>
    </div>

    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

    <script type="module">
       import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
       import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-auth.js";
       import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore.js";

       const firebaseConfig = {
           apiKey: "AIzaSyBFH1SGy9Gc7JJZhTLv2bktvTE4q_mSU3M",
           authDomain: "gklearnstudyy.firebaseapp.com",
           projectId: "gklearnstudyy",
           storageBucket: "gklearnstudyy.appspot.com",
           messagingSenderId: "256328121620",
           appId: "1:256328121620:web:6de8ba9ae25e83c4875601"
       };

       const app = initializeApp(firebaseConfig);
       const auth = getAuth(app);
       const db = getFirestore(app);
       const quill = new Quill('#editor', {
           theme: 'snow',
           modules: {
               toolbar: [
                   [{ 'font': [] }, { 'size': [] }],
                   ['bold', 'italic', 'underline', 'strike'],
                   [{ 'color': [] }, { 'background': [] }],
                   [{ 'align': [] }],
                   ['clean']
               ]
           }
       });

       document.addEventListener('DOMContentLoaded', function () {
           const logoutButton = document.getElementById('logoutButton');
           const submitButton = document.getElementById('submitPost');
           const createPostButton = document.getElementById('createPostButton');
           const postsContainer = document.getElementById('posts');
           const editorContainer = document.getElementById('editor');
           const postTitle = document.getElementById('postTitle');

           loadPosts();

           onAuthStateChanged(auth, (user) => {
               if (!user) {
                   window.location.href = 'login.html';
               }
           });

           logoutButton.addEventListener('click', handleLogout);
           createPostButton.addEventListener('click', function() {
               postTitle.style.display = 'block';
               editorContainer.style.display = 'block';
               submitButton.style.display = 'inline-block';
               postsContainer.style.display = 'none';
               const toolbar = document.querySelector('.ql-toolbar');
               if (toolbar) {
                   toolbar.style.display = 'block';
               }
           });

           function handleLogout() {
               signOut(auth)
                   .then(() => window.location.href = 'login.html')
                   .catch((error) => console.error('Error logging out:', error));
           }

         async function createPost() {
    const user = auth.currentUser;
    const postContent = quill.root.innerHTML; // Quill se HTML output le rahe hain
    const title = postTitle.value;

    if (postContent && title && user) {
        const existingTitles = await getExistingTitles();
        if (existingTitles.includes(title)) {
            alert("This title is already taken. Please choose a different title.");
            return;
        }

        // HTML content to be saved
        const htmlContent = `
            <html>
                <head>
                    <title>${title}</title>
                </head>
                <body>
                    ${postContent}
                </body>
            </html>
        `;

        try {
            await addDoc(collection(db, "posts"), {
                title: title,
                content: htmlContent, // HTML format mein content save ho raha hai
                status: "Pending",
                userId: user.uid,
                userName: user.displayName || user.email
            });

            // Reset and hide the editor and title input
            quill.setContents([]); // Clear the Quill editor
            postTitle.value = ''; // Clear the title input

            // Hide the editor and related elements
            editorContainer.style.display = 'none'; // Hide the editor
            submitButton.style.display = 'none'; // Hide the submit button
            postTitle.style.display = 'none'; // Hide the title input

            postsContainer.style.display = 'block'; // Show the posts container
            const toolbar = document.querySelector('.ql-toolbar');
            if (toolbar) {
                toolbar.style.display = 'none';
            }

            loadPosts(); // Reload the posts
        } catch (error) {
            console.error("Error adding document: ", error);
        }
    } else {
        alert("Please fill in both fields.");
    }
}

           

           async function getExistingTitles() {
               const postsSnapshot = await getDocs(collection(db, "posts"));
               const titles = [];
               postsSnapshot.forEach((doc) => {
                   titles.push(doc.data().title);
               });
               return titles;
           }

           async function loadPosts() {
               const postsSnapshot = await getDocs(collection(db, "posts"));
               postsContainer.innerHTML = '';

               const user = auth.currentUser;
               const isAdmin = user.email === "admin@example.com"; // Replace with actual admin email

               postsSnapshot.forEach((doc) => {
                   const post = doc.data();
                   const postElement = document.createElement('div');
                   postElement.className = 'post';

                   // Only show user's posts or all posts if the user is an admin
                   if (isAdmin || post.userId === user.uid) {
                       postElement.innerHTML = `
                           <h3>${post.title}</h3>
                           <div>${post.content}</div>
                           <p>Status: ${post.status}</p>
                       `;
                       postsContainer.appendChild(postElement);
                   }
               });
           }

           submitButton.addEventListener('click', createPost);
       });
          function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            // Assume successful login logic here
            if (username && password) { // Aap yahan actual validation laga sakte hain
                // Login success ke baad username ko localStorage me store karein
                localStorage.setItem('username', username);  // Actual username jo login ke baad milega
                alert("Login successful!"); // Optional alert
                // Redirect to the post creation page or wherever needed
                window.location.href = 'post-creation.html'; // Change to your post creation page
            } else {
                alert("Please enter valid credentials");
            }
        }async function createPost() {
    const title = document.getElementById('title').value;
    const content = document.getElementById('content').value;
    const username = localStorage.getItem('username'); // Get username from localStorage

    const post = {
        title,
        content,
        username, // Ensure username is included
        status: "Pending"
    };

    await addDoc(collection(db, "posts"), post);
    // Additional code...
}

    </script>
</body>
</html>













//*apna toolbar *//

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel with Header</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            flex-direction: column;
            margin: 0;
        }
        .header {
            width: 100%;
            background-color: #007bff;
            color: white;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            position: fixed;
            top: 0;
            left: 0;
            z-index: 1000;
        }
        .header button {
            padding: 10px 15px;
            background-color: white;
            color: #007bff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .header button:hover {
            background-color: #f0f0f0;
        }
        .admin-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            width: 600px;
            margin-top: 80px; /* To make space for header */
            text-align: center;
        }
        #postTitle {
            margin-bottom: 20px;
            display: none;
        }
        .editor-toolbar {
            display: none;
            margin-bottom: 10px;
        }
        .editor-toolbar button {
            margin-right: 5px;
            padding: 5px 10px;
            cursor: pointer;
        }
        #postContent {
            display: none;
            width: 100%;
            min-height: 150px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: white;
        }
        button {
            padding: 10px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .posts {
            width: 90%;
            margin-top: 20px;
            text-align: left;
        }
        .post {
            width: 90%;
            padding: 10px;
            border-bottom: 1px solid #ddd;
        }
    </style>
</head>
<body>

    <div class="header">
        <button id="createPostButton">Create a New Post</button>
        <button id="logoutButton">Logout</button>
    </div>

    <div class="admin-container">
        <h2>Admin Panel</h2>
        
        <input type="text" id="postTitle" placeholder="Post Title" style="width: 100%; padding: 10px; border-radius: 4px; border: 1px solid #ddd;" />
        
        <div class="editor-toolbar" id="editorToolbar">
            <button onclick="execCommand('bold')">Bold</button>
            <button onclick="execCommand('italic')">Italic</button>
            <button onclick="execCommand('underline')">Underline</button>
            <button onclick="execCommand('justifyLeft')">Left</button>
            <button onclick="execCommand('justifyCenter')">Center</button>
            <button onclick="execCommand('justifyRight')">Right</button>
            <input type="color" id="textColor" onchange="changeColor()">
        </div>

        <div id="postContent" contenteditable="true"></div>
        
        <button id="submitPost" style="display: none;">Submit Post</button>
        <button id="previewPost" style="display: none;">Preview</button>
        <div id="posts" class="posts"></div>
        <div id="previewContainer" style="display: none;">
            <h3>Post Preview</h3>
            <h4 id="previewTitle"></h4>
            <p id="previewContent"></p>
        </div>
    </div>

    <script type="module">
       import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
       import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-auth.js";
       import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore.js";

       const firebaseConfig = {
           apiKey: "AIzaSyBFH1SGy9Gc7JJZhTLv2bktvTE4q_mSU3M",
           authDomain: "gklearnstudyy.firebaseapp.com",
           projectId: "gklearnstudyy",
           storageBucket: "gklearnstudyy.appspot.com",
           messagingSenderId: "256328121620",
           appId: "1:256328121620:web:6de8ba9ae25e83c4875601"
       };

       const app = initializeApp(firebaseConfig);
       const auth = getAuth(app);
       const db = getFirestore(app);

       document.addEventListener('DOMContentLoaded', function () {
           const logoutButton = document.getElementById('logoutButton');
           const submitButton = document.getElementById('submitPost');
           const createPostButton = document.getElementById('createPostButton');
           const postsContainer = document.getElementById('posts');
           const editorContainer = document.getElementById('postContent');
           const postTitle = document.getElementById('postTitle');
           const previewButton = document.getElementById('previewPost');
           const previewContainer = document.getElementById('previewContainer');
           const previewTitle = document.getElementById('previewTitle');
           const previewContent = document.getElementById('previewContent');
           const editorToolbar = document.getElementById('editorToolbar');

           loadPosts();

           onAuthStateChanged(auth, (user) => {
               if (!user) {
                   window.location.href = 'login.html';
               }
           });

           logoutButton.addEventListener('click', handleLogout);
           createPostButton.addEventListener('click', function() {
               postTitle.style.display = 'block';
               editorContainer.style.display = 'block';
               submitButton.style.display = 'inline-block';
               previewButton.style.display = 'inline-block';
               postsContainer.style.display = 'none';
               editorToolbar.style.display = 'flex';
           });

           previewButton.addEventListener('click', function() {
               const title = postTitle.value;
               const content = editorContainer.innerHTML;
               if (title && content) {
                   previewTitle.innerText = title;
                   previewContent.innerHTML = content;
                   previewContainer.style.display = 'block';
               } else {
                   alert('Please fill in both title and content to preview.');
               }
           });

           function handleLogout() {
               signOut(auth)
                   .then(() => window.location.href = 'login.html')
                   .catch((error) => console.error('Error logging out:', error));
           }

           async function createPost() {
               const user = auth.currentUser;
               const postContent = editorContainer.innerHTML; // HTML content for formatting
               const title = postTitle.value;

               if (postContent && title && user) {
                   const existingTitles = await getExistingTitles();
                   if (existingTitles.includes(title)) {
                       alert("This title is already taken. Please choose a different title.");
                       return;
                   }

                   try {
                       await addDoc(collection(db, "posts"), {
                           title: title,
                           content: postContent, // Save HTML formatted content
                           status: "Pending",
                           userId: user.uid,
                           userName: user.displayName || user.email
                       });

                       // Reset and hide the editor and title input
                       editorContainer.innerHTML = ''; // Clear the content
                       postTitle.value = ''; // Clear the title input

                       // Hide the editor and related elements
                       editorContainer.style.display = 'none';
                       submitButton.style.display = 'none';
                       postTitle.style.display = 'none';
                       previewButton.style.display = 'none';
                       previewContainer.style.display = 'none';
                       editorToolbar.style.display = 'none';

                       postsContainer.style.display = 'block';
                       loadPosts(); // Reload the posts
                   } catch (error) {
                       console.error("Error adding document: ", error);
                   }
               } else {
                   alert("Please fill in both fields.");
               }
           }

           async function getExistingTitles() {
               const postsSnapshot = await getDocs(collection(db, "posts"));
               const titles = [];
               postsSnapshot.forEach((doc) => {
                   titles.push(doc.data().title);
               });
               return titles;
           }

           async function loadPosts() {
               postsContainer.innerHTML = '';
               const postsSnapshot = await getDocs(collection(db, "posts"));
               postsSnapshot.forEach((doc) => {
                   const post = doc.data();
                   const postDiv = document.createElement('div');
                   postDiv.classList.add('post');
                   postDiv.innerHTML = `<h4>${post.title}</h4><p>${post.content}</p>`;
                   postsContainer.appendChild(postDiv);
               });
           }

           submitButton.addEventListener('click', createPost);
       });

       function execCommand(command) {
           document.execCommand(command, false, null);
       }

       function changeColor() {
           const color = document.getElementById('textColor').value;
           document.execCommand('foreColor', false, color);
       }
    </script>
</body>
</html>
